<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="#" />
        <title>Web App</title>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script>
            const { createClient } = supabase;
        </script>
        <script src="/Web-App/supabase.js"></script>
    </head>
    <body>
        <h1>This is the main page</h1>

        <button onclick="signOut()">Sign Out</button>

        <table id="table">
            <tr id="0">
                <th id="00">Time</th>
                <th id="10">Monday</th>
                <th id="20">Tuesday</th>
                <th id="30">Wednesday</th>
                <th id="40">Thursday</th>
                <th id="50">Friday</th>
                <th id="60">Saturday</th>
                <th id="70">Sunday</th>
            </tr>
            <tr id="1">
                <th id="01">08:40 09:30</th>
            </tr>
            <tr id="2">
                <th id="02">09:40 10:30</th>
            </tr>
            <tr id="3">
                <th id="03">10:40 11:30</th>
            </tr>
            <tr id="4">
                <th id="04">11:40 12:30</th>
            </tr>
            <tr id="5">
                <th id="05">12:40 13:30</th>
            </tr>
            <tr id="6">
                <th id="06">13:40 14:30</th>
            </tr>
            <tr id="7">
                <th id="07">14:40 15:30</th>
            </tr>
            <tr id="8">
                <th id="08">15:40 16:30</th>
            </tr>
        </table>
    </body>

    <!-- main script -->
    <script type="text/javascript">
        // check if a user is signed in otherwise redirect to signin
        document.addEventListener("DOMContentLoaded", async function () {
            const userid = await checkSession();
            if (userid) {
                console.log(userid);
            } else {
                window.location.href = "/Web-App/auth/signin.html";
            }

            getData(userid);
        });

        async function getData(userid) {
            let { data: course, error } = await supabase
                .from("course")
                .select("*")

            if (error) {
                console.error("Error:", error.message);
            } else {
                console.log("Data:", course);
            }

            buildTable(course);
        }

        async function buildTable(data) {
            const table = document.getElementById("table");

            for (let i = 1; i < 9; i++) {
                const tr = document.getElementById(`${i}`);
                for (let j = 1; j < 8; j++) {
                    const th = document.createElement("th");
                    th.id = `${j}${i}`;
                    tr.appendChild(th);
                }
            }

            data.forEach((course) => {
                const th = document.getElementById(`${course.col}${course.row}`);
                th.innerHTML = `${course.name}\n(${course.section})\n[${course.room}]`;
                th.style.backgroundColor = course.color;
            })
        }
    </script>
</html>
