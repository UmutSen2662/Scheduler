<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Scheduler</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="A website for METU NCC schedule and exam tracking." />
        <link rel="stylesheet" href="/Scheduler/style.css" />
        <link rel="manifest" href="/Scheduler/manifest.json" />
        <link rel="shortcut icon" href="/Scheduler/scheduler any.png" />
        <script type="text/javascript" async>
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("/Scheduler/sw.js");
            }

            // handle offline
            async function handle_offline() {
                const online = await isOnline();
                if (online) return;
                document.getElementById("overlay").style.display = "block";
                const signInOut = document.getElementById("signInOut");
                signInOut.style.backgroundColor = "#D32F2F";
                signInOut.innerHTML = "Offline";
            }
            document.addEventListener("DOMContentLoaded", () => {
                handle_offline();
            });
            window.addEventListener("offline", () => {
                handle_offline();
            });
            async function isOnline() {
                if (!window.navigator.onLine) return false;

                const url = new URL(window.location.origin + "/Scheduler/isOnline");
                // random value to prevent cached responses
                url.searchParams.set("rand", Math.random().toString(36).substring(2, 15));
                try {
                    const response = await fetch(url.toString(), { method: "HEAD" });
                    return response.ok;
                } catch {
                    return false;
                }
            }
        </script>
    </head>
    <body style="display: flex; align-items: center; flex-direction: column">
        <div id="overlay"></div>

        <div style="display: flex; justify-content: space-between; padding: 0.5rem; width: 100%">
            <h2>METU Schedule and CEF</h2>
            <button id="signInOut" style="padding: 0.6rem" onclick="signInOut()">Sign In</button>
        </div>

        <h2 style="padding: 0.5rem">Schedule</h2>
        <table id="schedule" style="font-weight: 700">
            <tr id="0">
                <th id="00">Time</th>
                <th id="10">Monday</th>
                <th id="20">Tuesday</th>
                <th id="30">Wednesday</th>
                <th id="40">Thursday</th>
                <th id="50">Friday</th>
            </tr>
            <tr id="1">
                <td id="01">08:40</td>
                <td id="11"></td>
                <td id="21"></td>
                <td id="31"></td>
                <td id="41"></td>
                <td id="51"></td>
            </tr>
            <tr id="2">
                <td id="02">09:40</td>
                <td id="12"></td>
                <td id="22"></td>
                <td id="32"></td>
                <td id="42"></td>
                <td id="52"></td>
            </tr>
            <tr id="3">
                <td id="03">10:40</td>
                <td id="13"></td>
                <td id="23"></td>
                <td id="33"></td>
                <td id="43"></td>
                <td id="53"></td>
            </tr>
            <tr id="4">
                <td id="04">11:40</td>
                <td id="14"></td>
                <td id="24"></td>
                <td id="34"></td>
                <td id="44"></td>
                <td id="54"></td>
            </tr>
            <tr id="5">
                <td id="05">12:40</td>
                <td id="15"></td>
                <td id="25"></td>
                <td id="35"></td>
                <td id="45"></td>
                <td id="55"></td>
            </tr>
            <tr id="6">
                <td id="06">13:40</td>
                <td id="16"></td>
                <td id="26"></td>
                <td id="36"></td>
                <td id="46"></td>
                <td id="56"></td>
            </tr>
            <tr id="7">
                <td id="07">14:40</td>
                <td id="17"></td>
                <td id="27"></td>
                <td id="37"></td>
                <td id="47"></td>
                <td id="57"></td>
            </tr>
            <tr id="8">
                <td id="08">15:40</td>
                <td id="18"></td>
                <td id="28"></td>
                <td id="38"></td>
                <td id="48"></td>
                <td id="58"></td>
            </tr>
            <tr id="9">
                <td id="09">16:40</td>
                <td id="19"></td>
                <td id="29"></td>
                <td id="39"></td>
                <td id="49"></td>
                <td id="59"></td>
            </tr>
            <tr id="a">
                <td id="0a">17:40</td>
                <td id="1a"></td>
                <td id="2a"></td>
                <td id="3a"></td>
                <td id="4a"></td>
                <td id="5a"></td>
            </tr>
            <tr id="b">
                <td id="0b">18:40</td>
                <td id="1b"></td>
                <td id="2b"></td>
                <td id="3b"></td>
                <td id="4b"></td>
                <td id="5b"></td>
            </tr>
            <tr id="c">
                <td id="0c">19:40</td>
                <td id="1c"></td>
                <td id="2c"></td>
                <td id="3c"></td>
                <td id="4c"></td>
                <td id="5c"></td>
            </tr>
        </table>

        <div id="courseCodes">
            <p>Write course codes then press enter</p>
            <div id="tagsContainer">
                <input type="text" id="tagsInput" />
            </div>
        </div>
        <div id="examsContainer">
            <table id="exams">
                <tr>
                    <th>Course Exam</th>
                    <th>Days Until</th>
                    <th>Days Between</th>
                    <th>Start Time</th>
                    <th>Classrooms</th>
                </tr>
            </table>
        </div>

        <dialog id="modal">
            <div style="padding: 1rem">
                <div id="modalInside"></div>
                <div id="modalColor">
                    <button
                        style="background: #f0f0f0"
                        onclick="Modal.set('color', ''); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #ff2a2a"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #ff9515"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #ffff00"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #b6ff00"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #00b020"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #00ffc0"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #40d0ff"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #3080ff"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                    <button
                        style="background: #9752cb"
                        onclick="Modal.set('color', this.style.backgroundColor); modalButtons(this.style.backgroundColor);"
                    ></button>
                </div>
                <form method="dialog">
                    <button style="margin-right: auto; background: #e00" onclick="modalDelete()">
                        Delete
                    </button>
                    <button style="margin-right: 0.4rem" onclick="modalSave()">Save</button>
                    <button style="background: #999" onclick="">Cancel</button>
                </form>
            </div>
        </dialog>
        <a style="margin: 1rem; margin-left: auto" href="https://github.com/UmutSen2662/Scheduler"
            >GitHub Page</a
        >

        <script src="/Scheduler/supabase.js" type="module"></script>
        <script src="/Scheduler/index.js" defer></script>
    </body>
</html>
